<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مشاهدة المباراة - كورة لايف</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-green': '#1a472a',
                        'light-green': '#2ecc71',
                    },
                    fontFamily: {
                        'tajawal': ['Tajawal', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
        body {
            font-family: 'Tajawal', sans-serif;
        }
        .aspect-ratio-container {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* نسبة 16:9 */
        }
        .aspect-ratio-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
    <script type='text/javascript' src='//pl24568977.cpmrevenuegate.com/e7/33/45/e7334529fdbdf00570421f65ed8a3561.js'></script>
</head>
<body class="bg-gray-900 text-white font-tajawal">
    <header class="bg-dark-green shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-4xl font-bold text-accent-yellow">كورة لايف</h1>
            <nav>
                <ul class="flex space-x-6">
                    <li><a href="index.html" class="hover:text-accent-yellow transition duration-300"><i class="fas fa-home ml-1"></i>الرئيسية</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <div class="bg-gray-800 rounded-lg shadow-xl overflow-hidden">
            <div class="p-6">
                <h2 class="text-3xl font-bold mb-4 text-light-green" id="matchTitle">تحميل...</h2>
                <div class="flex justify-between items-center mb-6">
                    <div class="text-center">
                        <img src="" alt="" id="team1Logo" class="w-24 h-24 mx-auto mb-2 rounded-full border-4 border-light-green">
                        <p class="text-xl font-bold" id="team1Name">تحميل...</p>
                    </div>
                    <div class="text-4xl font-bold text-light-green">VS</div>
                    <div class="text-center">
                        <img src="" alt="" id="team2Logo" class="w-24 h-24 mx-auto mb-2 rounded-full border-4 border-light-green">
                        <p class="text-xl font-bold" id="team2Name">تحميل...</p>
                    </div>
                </div>
                <div class="mb-6" id="streamContainer">
                    <div class="aspect-ratio-container mb-4">
                        <iframe id="streamIframe" src="" frameborder="0" allowfullscreen></iframe>
                    </div>
                    <div id="streamLinks" class="flex flex-wrap justify-center"></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-xl font-semibold mb-2 text-light-green">معلومات المباراة</h3>
                        <p class="mb-2"><i class="far fa-calendar-alt ml-2"></i><span id="matchDate">تحميل...</span></p>
                        <p class="mb-2"><i class="fas fa-trophy ml-2"></i><span id="tournament">تحميل...</span></p>
                        <p><i class="fas fa-microphone ml-2"></i><span id="commentator">تحميل...</span></p>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-2 text-light-green">الإحصائيات</h3>
                        <p class="mb-2">الاستحواذ: <span id="possession">تحميل...</span></p>
                        <p class="mb-2">التسديدات: <span id="shots">تحميل...</span></p>
                        <p>الأخطاء: <span id="fouls">تحميل...</span></p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-8">
            <h3 class="text-2xl font-semibold mb-4 text-light-green">التعليقات الحية</h3>
            <div id="liveComments" class="bg-gray-800 rounded-lg p-4 h-64 overflow-y-auto mb-4">
                <!-- التعليقات ستضاف هنا ديناميكيًا -->
            </div>
            <div class="flex">
                <input type="text" id="commentInput" placeholder="أضف تعليقك..." class="flex-grow bg-gray-700 text-white rounded-l-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-light-green">
                <button id="sendComment" class="bg-light-green hover:bg-green-600 text-gray-900 font-bold rounded-r-lg px-4 py-2 transition duration-300">إرسال</button>
            </div>
        </div>
    </main>

    <footer class="bg-dark-green mt-12 py-8">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2024 كورة لايف - جميع الحقوق محفوظة</p>
            <div class="mt-4 flex justify-center space-x-4">
                <a href="#" class="text-white hover:text-light-green transition duration-300"><i class="fab fa-facebook fa-2x"></i></a>
                <a href="#" class="text-white hover:text-light-green transition duration-300"><i class="fab fa-twitter fa-2x"></i></a>
                <a href="#" class="text-white hover:text-light-green transition duration-300"><i class="fab fa-instagram fa-2x"></i></a>
                <a href="#" class="text-white hover:text-light-green transition duration-300"><i class="fab fa-youtube fa-2x"></i></a>
            </div>
        </div>
    </footer>

    <script>
        async function fetchMatchDetails(watchId) {
            try {
                const response = await fetch(`https://spider-stirring-thrush.ngrok-free.app/matches`, {
                    headers: {
                        'ngrok-skip-browser-warning': 'true'
                    }
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                return data.matches.find(match => match.watch_Id === watchId);
            } catch (error) {
                console.error('Error fetching match details:', error);
                return null;
            }
        }

        function updateMatchInfo(match) {
            document.getElementById('matchTitle').textContent = match.title;
            document.getElementById('team1Logo').src = match.team1_logo;
            document.getElementById('team1Logo').alt = match.team1;
            document.getElementById('team1Name').textContent = match.team1;
            document.getElementById('team2Logo').src = match.team2_logo;
            document.getElementById('team2Logo').alt = match.team2;
            document.getElementById('team2Name').textContent = match.team2;
            document.getElementById('matchDate').textContent = new Date(match.start_time).toLocaleString('ar-EG');
            document.getElementById('tournament').textContent = match.tournament;
            document.getElementById('commentator').textContent = match.commentator || 'غير متوفر';
        }

        async function initializeWatchPage() {
            const urlParams = new URLSearchParams(window.location.search);
            const watchId = urlParams.get('id');
            const streamUrl = urlParams.get('stream');

            if (watchId && streamUrl) {
                const match = await fetchMatchDetails(watchId);
                if (match) {
                    updateMatchInfo(match);
                    document.getElementById('streamIframe').src = streamUrl;
                } else {
                    document.getElementById('streamContainer').innerHTML = '<p class="text-2xl">عذراً، لم يتم العثور على معلومات المباراة.</p>';
                }
            } else {
                document.getElementById('streamContainer').innerHTML = '<p class="text-2xl">عذراً، لم يتم تحديد معرف المباراة أو رابط البث.</p>';
            }
        }

        initializeWatchPage();

        // إضافة وظيفة لإرسال التعليقات
        document.getElementById('sendComment').addEventListener('click', () => {
            const commentInput = document.getElementById('commentInput');
            const comment = commentInput.value.trim();
            if (comment) {
                const liveComments = document.getElementById('liveComments');
                const commentElement = document.createElement('p');
                commentElement.textContent = comment;
                commentElement.className = 'mb-2';
                liveComments.appendChild(commentElement);
                liveComments.scrollTop = liveComments.scrollHeight;
                commentInput.value = '';
            }
        });
    </script>
</body>
</html>